{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"/Users/cathychen/Desktop/WebProgramming/NTU-WebProgramming-FinalProject/love_diary/src/components/Diary/PicturesWall.js\",\n    _s = $RefreshSig$();\n\nimport { Upload, Modal } from 'antd';\nimport { PlusOutlined } from '@ant-design/icons';\nimport { React, Component, useReducer } from 'react';\nimport { Input } from 'antd'; // const multer = require('multer');\n// var upload = multer({\n//   fileFilter: (req, file, cb) => {\n//       if (file.mimetype == \"image/png\") {\n//           cb(null, true)\n//       } else {\n//           cb(null, false)\n//           return cb(new Error('Allowed only .png'))\n//       }\n//   }\n// })\n// var upload = multer({storage: storage})\n\nconst SERVER_URL = 'http://localhost:8000';\nconst UPLOAD_URL = `${SERVER_URL}/upload`;\nconst {\n  TextArea\n} = Input;\n\nfunction getBase64(file) {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.readAsDataURL(file);\n\n    reader.onload = () => resolve(reader.result);\n\n    reader.onerror = error => reject(error);\n  });\n}\n\nclass TextInput extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      value: ''\n    };\n\n    this.onChange = ({\n      target: {\n        value\n      }\n    }) => {\n      this.setState({\n        value\n      });\n    };\n  }\n\n  render() {\n    const {\n      value\n    } = this.state;\n    return /*#__PURE__*/_jsxDEV(TextArea, {\n      value: value,\n      onChange: this.onChange,\n      placeholder: \"Something with this image.\",\n      autoSize: {\n        minRows: 3,\n        maxRows: 3\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 47,\n      columnNumber: 9\n    }, this);\n  }\n\n}\n\nconst todoReducer = (state, action) => {\n  // 判斷指令\n  switch (action.type) {\n    case 'cancel':\n      return { ...state,\n        previewVisible: false\n      };\n\n    case 'preview':\n      return { ...state,\n        previewImage: action.payload.file.url || action.payload.file.thumbUrl,\n        previewVisible: true,\n        previewImageName: action.payload.file.name\n      };\n\n    case 'change':\n      console.log(action.payload.list);\n      return { ...state,\n        fileList: action.payload.list\n      };\n\n    default:\n      return state;\n  }\n}; // 初始資料，為 state 的初始值，通常會在這裡把結構描述完整\n\n\nconst initState = {\n  previewVisible: false,\n  previewImage: '',\n  previewTitle: '',\n  fileList: []\n};\nexport default function PicturesWall() {\n  _s();\n\n  const [state, dispatch] = useReducer(todoReducer, initState);\n\n  const handleCancel = () => dispatch({\n    type: 'cancel'\n  });\n\n  const handlePreview = async file => {\n    if (!file.url && !file.preview) {\n      file.preview = await getBase64(file.originFileObj);\n    }\n\n    dispatch({\n      type: 'preview',\n      payload: {\n        file: file\n      }\n    });\n  };\n\n  const handleChange = ({\n    file,\n    fileList\n  }) => {\n    const {\n      status,\n      response\n    } = file;\n    console.log(status);\n    dispatch({\n      type: 'change',\n      payload: {\n        list: fileList\n      }\n    });\n    console.log(state.fileList);\n  };\n\n  const uploadButton = /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(PlusOutlined, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        marginTop: 8,\n        color: '#666'\n      },\n      children: \"Upload\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 109,\n    columnNumber: 5\n  }, this);\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(Upload, {\n      action: UPLOAD_URL,\n      listType: \"picture-card\",\n      fileList: state.fileList,\n      onPreview: handlePreview,\n      onChange: handleChange,\n      children: state.fileList.length >= 1 ? null : uploadButton\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 118,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Modal\n    /*用於查看圖片*/\n    , {\n      visible: state.previewVisible,\n      title: state.previewTitle,\n      footer: null,\n      onCancel: handleCancel,\n      children: /*#__PURE__*/_jsxDEV(\"img\", {\n        alt: \"photo\",\n        style: {\n          width: '100%'\n        },\n        src: state.previewImage\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 133,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 127,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(TextInput, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 135,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n}\n\n_s(PicturesWall, \"ivzsx5aR9qRFuEtyOcndflQiQ1Q=\");\n\n_c = PicturesWall;\n\nvar _c;\n\n$RefreshReg$(_c, \"PicturesWall\");","map":{"version":3,"sources":["/Users/cathychen/Desktop/WebProgramming/NTU-WebProgramming-FinalProject/love_diary/src/components/Diary/PicturesWall.js"],"names":["Upload","Modal","PlusOutlined","React","Component","useReducer","Input","SERVER_URL","UPLOAD_URL","TextArea","getBase64","file","Promise","resolve","reject","reader","FileReader","readAsDataURL","onload","result","onerror","error","TextInput","state","value","onChange","target","setState","render","minRows","maxRows","todoReducer","action","type","previewVisible","previewImage","payload","url","thumbUrl","previewImageName","name","console","log","list","fileList","initState","previewTitle","PicturesWall","dispatch","handleCancel","handlePreview","preview","originFileObj","handleChange","status","response","uploadButton","marginTop","color","length","width"],"mappings":"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","sourcesContent":["import { Upload, Modal } from 'antd';\nimport { PlusOutlined } from '@ant-design/icons';\nimport {React, Component, useReducer} from 'react';\nimport { Input } from 'antd';\n\n// const multer = require('multer');\n\n// var upload = multer({\n//   fileFilter: (req, file, cb) => {\n//       if (file.mimetype == \"image/png\") {\n//           cb(null, true)\n//       } else {\n//           cb(null, false)\n//           return cb(new Error('Allowed only .png'))\n//       }\n//   }\n// })\n\n// var upload = multer({storage: storage})\n\nconst SERVER_URL = 'http://localhost:8000'\nconst UPLOAD_URL = `${SERVER_URL}/upload`\n\nconst { TextArea } = Input;\n\nfunction getBase64(file) {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.readAsDataURL(file);\n    reader.onload = () => resolve(reader.result);\n    reader.onerror = error => reject(error);\n  });\n}\n\nclass TextInput extends Component {\n  state = {\n    value: '',\n  };\n\n  onChange = ({ target: { value } }) => {\n    this.setState({ value });\n  };\n\n  render() {\n    const { value } = this.state;\n    return (\n        <TextArea\n          value={value}\n          onChange={this.onChange}\n          placeholder=\"Something with this image.\"\n          autoSize={{ minRows: 3, maxRows: 3 }}\n        />\n    );\n  }\n}\n\nconst todoReducer = (state, action) => {\n  // 判斷指令\n  switch (action.type) {\n      case 'cancel':\n        return{ ...state, previewVisible: false }\n      case 'preview':\n        return{\n          ...state,\n          previewImage: action.payload.file.url || action.payload.file.thumbUrl,\n          previewVisible: true,\n          previewImageName: action.payload.file.name\n        }\n      case 'change':\n        console.log(action.payload.list)\n        return{\n          ...state,\n          fileList: action.payload.list\n        }\n      default:\n          return state\n  }\n}\n\n// 初始資料，為 state 的初始值，通常會在這裡把結構描述完整\nconst initState = {\n  previewVisible: false,\n  previewImage: '',\n  previewTitle: '',\n  fileList: [],\n}\n\nexport default function PicturesWall(){\n  const [state, dispatch] = useReducer(todoReducer, initState);\n\n  const handleCancel = () => dispatch({ type: 'cancel'});\n\n  const handlePreview = async file => {\n    if (!file.url && !file.preview) {\n      file.preview = await getBase64(file.originFileObj);\n    }\n\n    dispatch({ type: 'preview', payload: { file: file } });\n  };\n\n  const handleChange = ({ file, fileList }) => {\n    const { status, response } = file;\n    console.log(status);\n    dispatch({ type: 'change', payload: { list: fileList } });\n    console.log(state.fileList);\n  }\n\n  const uploadButton = (\n    <div>\n      <PlusOutlined />\n      <div style={{ marginTop: 8, color: '#666' }}>Upload</div>\n    </div>\n  );\n\n\n  return (\n    <>\n      <Upload\n        action={UPLOAD_URL}\n        listType=\"picture-card\"\n        fileList={state.fileList}\n        onPreview={handlePreview}\n        onChange={handleChange}\n      >\n        {state.fileList.length >= 1 ? null : uploadButton}\n      </Upload>\n      <Modal /*用於查看圖片*/\n        visible={state.previewVisible}\n        title={state.previewTitle}\n        footer={null}\n        onCancel={handleCancel}\n      >\n        <img alt=\"photo\" style={{ width: '100%' }} src={state.previewImage} />\n      </Modal>\n      <TextInput />\n    </>\n  );\n}"]},"metadata":{},"sourceType":"module"}